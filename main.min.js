"use strict";
var ScpoAJAX;
(function (scpo) {
	var query = {
		toStr: function (form) {
			var iptlist = form.getElementsByTagName("input"), i = -1, ipt, str = "";
			while (ipt = iptlist[++i]) str += ipt.name + "=" + ipt.value + "&";
			return str.slice(0, -1);
		},
		toObj: function (form) {
			var iptlist = form.getElementsByTagName("input"), i = -1, ipt, obj = {}
			while (ipt = iptlist[++i]) obj[ipt.name] = ipt.value;
			return obj;
		},
		obj2str: function (obj) {
			var str = "";
			for (var i in obj) str += i + "=" + obj[i] + "&";
			return str.slice(0, -1);
		},
		str2obj: function (str) {
			var arr = str.split("&"), obj = {}, pos, i = 0;
			while (str = arr[i++]) obj[str.slice(0, pos = str.indexOf("="))] = str.slice(pos + 1);
			return obj;
		}
	};
	scpo.query = query;
	var xmlhttp = null;
	try {
		xmlhttp = new XMLHttpRequest();
	} catch (err) {
		xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
	}
	scpo.xmlhttp = xmlhttp;
	scpo.async = true;
	function request(url, method, data, todo, ordo, format, async, scdo) {
		if (typeof async === "undefined") async = scpo.async;
		if (async) xmlhttp.onreadystatechange = function () {
			if (xmlhttp.readyState === 4 && async) {
				if (xmlhttp.status === 200 && todo) todo(format === "xml" ? xmlhttp.responseXML : xmlhttp.responseText)
				else if (ordo) ordo(xmlhttp);
			} else if (scdo) scdo(xmlhttp);
		}
		if (typeof data === "object") data = query.obj2str(data);
		if (method === "get") {
			xmlhttp.open("GET", url + (data ? "?" + data : ""), async);
			xmlhttp.send();
		} else {
			xmlhttp.open("POST", url, async);
			xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			xmlhttp.send(data);
		}
		if (!async) {
			if (xmlhttp.status === 200) return todo(format === "xml" ? xmlhttp.responseXML : xmlhttp.responseText);
			else return ordo(xmlhttp);
		}
	}
	function get(url, data, todo, ordo, format, async, scdo) {
		request(url, "get", data, todo, ordo, format, async, scdo);
	}
	function post(url, data, todo, ordo, format, async, scdo) {
		request(url, "post", data, todo, ordo, format, async, scdo);
	}
	scpo.request = request;
	scpo.get = get;
	scpo.post = post;
}(window.ScpoAJAX ? ScpoAJAX : window.ScpoAJAX = {}));